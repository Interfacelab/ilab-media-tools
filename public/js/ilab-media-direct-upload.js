!function(e){var t={};function i(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(o,s,function(t){return e[t]}.bind(null,s));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i(i.s=321)}({321:function(e,t,i){e.exports=i(322)},322:function(e,t){window.DirectUploadItem=Backbone.Model.extend({initialize:function(e){this.on("change:progress",this.updateProgress,this)},updateProgress:function(){var e=this.get("attachment"),t=this.get("progress");e.set({percent:t})},startUpload:function(){if("uploadToStorage"in DirectUploadItem.prototype){var e=this.get("file"),t=this.get("faces"),i=this.get("mimeType");this.uploadToStorage(e,t,i,this)}else alert("Direct upload is misconfigured.")},uploadFinished:function(e,t){var i=this.get("attachment"),o={action:"ilab_upload_import_cloud_file",key:e};null!=t&&t.length>0&&(o.faces=t),$.post(ajaxurl,o,function(e){_.each(["file","loaded","size","percent"],function(e){i.unset(e)}),"success"==e.status?(console.log("Finished direct upload."),i.set(_.extend(e.attachment,{uploading:!1})),wp.media.model.Attachment.get(e.attachment.id,i),this.set({state:"done"})):(console.log("Direct upload error."),this.set({state:"error"})),wp.Uploader.queue.remove(i),wp.Uploader.queue.all(function(e){return!e.get("uploading")})&&wp.Uploader.queue.reset()}.bind(this))},uploadError:function(){console.log("upload error"),this.set({state:"error"});var e=this.get("attachment");_.each(["file","loaded","size","percent"],function(t){e.unset(t)}),wp.Uploader.queue.remove(e),e.destroy()}}),window.DirectUploader=Backbone.Model.extend({initialize:function(e){this.totalFilesDropped=0,this.totalFilesUploaded=0,this.files=[],this.toBulkProcess=[],this.uploadingFiles=[],this.watchToken=0,this.settings=mediaCloudDirectUploadSettings},queueNext:function(){if(clearTimeout(this.watchToken),this.uploadingFiles.length<this.settings.maxUploads&&this.files.length>0){var e=this.settings.maxUploads-this.uploadingFiles.length;console.log("Queueing "+e+" additional uploads.");for(var t=0;t<e;t++)if(this.files.length>0){var i=this.files.shift();console.log("Enqueuing direct upload."),this.uploadingFiles.push(i),i.startUpload()}}else if(0==this.uploadingFiles.length&&this.toBulkProcess.length>0&&(console.log(this.totalFilesDropped,this.totalFilesUploaded,this.toBulkProcess),this.totalFilesDropped==this.totalFilesUploaded)){var o={action:"ilab_upload_process_batch",batch:this.toBulkProcess};this.toBulkProcess=[],this.totalFilesDropped=0,this.totalFilesUploaded=0,$.post(ajaxurl,o,function(e){console.log(e)})}this.watchToken=setTimeout(this.queueNext.bind(this),500)},addFile:function(e){if(""==e.type)return!1;var t=e.type;if("application/x-photoshop"==t&&(t="image/psd"),-1==this.settings.allowedMimes.indexOf(t))return!1;var i=t.split("/"),o=i[0],s=i[1];if(s="jpg"==s?"jpeg":s,"image"==o){if(!this.settings.imgixEnabled)return!1;if(-1==["jpeg","gif","png"].indexOf(s)){if(!this.settings.extrasEnabled)return!1;if(-1==["psd","tiff","bmp"].indexOf(s))return!1}}else if("video"==o){if(!this.settings.videoEnabled)return!1}else if(!this.settings.docsEnabled)return!1;this.totalFilesDropped++;var n={file:e,uploading:!0,date:new Date,filename:e.name,menuOrder:0,uploadedTo:wp.media.model.settings.post.id,loaded:0,size:e.size,percent:0,type:o,subType:s},a=wp.media.model.Attachment.create(n);wp.Uploader.queue.add(a);var l=new DirectUploadItem({attachment:a,file:e,mimeType:t,progress:0,driver:this.settings.driver,faces:null,state:"waiting"});l.on("change:state",function(e,t){if("done"==t||"error"==t){this.totalFilesUploaded++,"done"==t&&this.toBulkProcess.push(a.id);var i=this.files.indexOf(l);i>-1&&this.files.splice(i),(i=this.uploadingFiles.indexOf(l))>-1&&this.uploadingFiles.splice(i),this.queueNext()}}.bind(this)),"undefined"!=typeof ILABFaceDetector?ILABFaceDetector(e,function(e){l.set("faces",e),this.files.push(l)}.bind(this)):this.files.push(l)}}),wp.media.view.UploaderWindow.prototype.__ready=wp.media.view.UploaderWindow.prototype.ready,wp.media.view.UploaderWindow.prototype.ready=function(){this.__ready(),this.directUploader=new DirectUploader({}),this.uploader.uploader.unbind("FilesAdded"),this.uploader.uploader.bind("FilesAdded",function(e,t){_.each(t,function(e){this.directUploader.addFile(e.getNative())}.bind(this)),this.directUploader.queueNext()}.bind(this))},wp.media.view.UploaderInline=wp.media.view.UploaderInline.extend({template:wp.template("media-cloud-direct-upload")})}});